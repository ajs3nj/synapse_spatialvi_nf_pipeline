// Nextflow config for spatialvi meta-workflow
// Designed to run on Seqera Tower in three steps:
//   1. --entry stage    : Download from Synapse, prepare spatialvi samplesheet
//   2. Run spatialvi directly on Tower
//   3. --entry synindex : Index results back to Synapse

// Input (required): path to CSV samplesheet with Synapse IDs
params.input = null

// S3 URI where all outputs are stored. Required.
params.outdir = null

// Synapse folder where results will be indexed
params.results_parent_id = null

// Use cytaimage column (Cytassist tissue image) instead of image (brightfield)
params.cytassist = false

// Entry point (stage, synindex, or default for help)
params.entry = null

// Profiles
profiles {

  docker {
    docker.enabled = true
  }

  tower {
    process.executor = 'awsbatch'
  }

  stage {
    params.entry = 'stage'
  }

  synindex {
    params.entry = 'synindex'
  }
}

// Entry point routing
if (params.entry == 'stage') {
  workflowSelection = 'STAGE'
} else if (params.entry == 'synindex') {
  workflowSelection = 'SYNINDEX'
}
