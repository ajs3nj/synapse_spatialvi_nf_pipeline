// Nextflow config for spatialvi + Synapse pipeline
// Designed to run on Seqera Tower with Synapse staging and result indexing

// Input (required): path to CSV samplesheet with Synapse IDs
params.input = null

// Synapse folder where results will be indexed (per sample)
params.results_parent_id = null

// Test mode: only stage from Synapse, create fastq tarball, and upload tarball back to Synapse (no spatialvi)
params.test_staging_only = false

// SpatialVI pipeline: Sage Bionetworks fork (https://github.com/sagebio-ada/spatialvi)
params.spatialvi_pipeline = 'sagebio-ada/spatialvi'
// Branch or tag to run (e.g. 'dev', 'main', or a release tag)
params.spatialvi_release = 'dev'
// Space Ranger reference (tar.gz); used by spatialvi for alignment/counting
params.spaceranger_reference = 's3://ntap-add5-project-tower-bucket/reference/refdata-gex-GRCh38-2020-A.tar.gz'
// Space Ranger probeset for FFPE/Cytassist (e.g. Visium Human Transcriptome Probe Set v2)
params.spaceranger_probeset = 's3://ntap-add5-project-tower-bucket/spatialvi_testing/Visium_Human_Transcriptome_Probe_Set_v2.0_GRCh38-2020-A.csv'
// Use cytaimage column (Cytassist tissue image) instead of image (brightfield) in spatialvi samplesheet
params.cytassist = false
// S3 URI where all outputs are stored (staging, spatialvi results). Required.
params.outdir = null
// Container image for processes that run Nextflow (RUN_SYNSTAGE, RUN_SPATIALVI, INDEX_TO_SYNAPSE).
// Override in Tower or -params-file if Wave cannot pull from Docker Hub (e.g. use an ECR copy).
params.nextflow_container = 'nextflow/nextflow:25.10.4'

// Wave: if your Tower workspace cannot pull nextflow/nextflow (400 from Wave), either add Docker Hub
// credentials in Tower or disable Wave so the executor (e.g. AWS Batch) pulls images instead:
//   wave { enabled = false }
// Or set params.nextflow_container to an image in a registry your workspace can access.

// Profiles
profiles {

  docker {
    docker.enabled = true
  }

  tower {
    // Use with Seqera Tower; combine with docker (e.g. -profile tower,docker)
    process.executor = 'awsbatch'
    executor = 'awsbatch'
  }

  // Use -profile no_wave if Wave cannot pull containers (e.g. nextflow/nextflow); executor will pull instead
  no_wave {
    wave.enabled = false
  }
}
